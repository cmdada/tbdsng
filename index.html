<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Building Dating Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom right, #ff9a9e, #fad0c4);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #game-container {
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        h1 {
            text-align: center;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        #options-window {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            z-index: 2;
        }
        #options-window h2 {
            margin-top: 0;
        }
        #options-window button {
            margin-top: 10px;
        }
        #small-screen-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom right, #ff9a9e, #fad0c4);
            z-index: 1000;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        #small-screen-message h2 {
            margin-top: 40%;
        }
    </style>
</head>
<body>
    <canvas id="background-canvas"></canvas>
    <div id="game-container">
        <h1>TableBuildingDatingSimulator.exe</h1>
        <div id="game"></div>
    </div>
    <div id="small-screen-message">
        <h2>Screen Too Small</h2>
        <p>Sorry, this game requires a larger screen to play. Please try on a device with a wider screen.</p>
    </div>
    <div id="options-window">
        <h2>Options</h2>
        <label for="font-size">Font Size:</label>
        <select id="font-size">
            <option value="16">Small</option>
            <option value="20" selected>Medium</option>
            <option value="24">Large</option>
        </select>
        <br>
        <label for="bg-color-1">Background Color 1:</label>
        <input type="color" id="bg-color-1" value="#ff9a9e">
        <br>
        <label for="bg-color-2">Background Color 2:</label>
        <input type="color" id="bg-color-2" value="#fad0c4">
        <br>
        <button id="apply-options">Apply</button>
        <button id="close-options">Close</button>
    </div>
<script>
    // Background animation
    const canvas = document.getElementById('background-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const flyingImage = new Image();
    flyingImage.src = 'assets/flying_image.png';

    let imageX = canvas.width;
    let imageY = -100;

    function animateBackground() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(flyingImage, imageX, imageY, 100, 100);

        imageX -= 2; 
        imageY += 1.12; 

        if (imageX < -100 || imageY > canvas.height) {
            imageX = canvas.width;
            imageY = -100;
        }

        requestAnimationFrame(animateBackground);
    }

    flyingImage.onload = animateBackground;

    // Phaser game scenes
    class MainScene extends Phaser.Scene {
        constructor() {
            super('MainScene');
        }

        preload() {
            this.load.image('background', 'assets/bg.png');
            this.load.video('intro', 'assets/intro.mp4');
        }

        create() {
            this.add.image(400, 300, 'background');
            this.startText = this.add.text(200, 450, 'start', { fontSize: '20px' });
            this.optionsText = this.add.text(600, 450, 'options', { fontSize: '20px' });
            this.titleText = this.add.text(400, 50, 'Build a table to win their heart!', {
                fontSize: '24px',
                fill: '#ffffff',
                align: 'center'
            }).setOrigin(0.5);

            this.startText.setInteractive();
            this.startText.on('pointerdown', () => {
                this.scene.start('IntroScene');
            });

            this.optionsText.setInteractive();
            this.optionsText.on('pointerdown', showOptionsWindow);
        }

        update() {
            // Game logic goes here :3
        }
    }
class IntroScene extends Phaser.Scene {
        constructor() {
            super('IntroScene');
        }
    
        create() {
            const video = this.add.video(400, 300, 'intro');
            video.play();
            video.on('complete', function() {
                this.scene.start('TableBuildingScene');
            }, this);
    
            // Add skip button
            const skipButton = this.add.text(700, 550, 'Skip', {
                fontSize: '20px',
                fill: '#ffffff',
                backgroundColor: '#4a4a4a',
                padding: { x: 10, y: 5 }
            }).setInteractive();
    
            skipButton.on('pointerdown', () => {
                video.stop();
                this.scene.start('TableBuildingScene');
            });
        }
    }

class TableBuildingScene extends Phaser.Scene {
    constructor() {
        super('TableBuildingScene');
    }

    create() {
        this.add.text(400, 50, 'Build Your Table!', {
            fontSize: '24px',
            fill: '#ffffff',
            align: 'center'
        }).setOrigin(0.5);

        this.graphics = this.add.graphics();
        this.lines = [];
        this.currentLine = null;
        this.lastEndPoint = null;

        this.input.on('pointerdown', this.startLine, this);
        this.input.on('pointermove', this.drawLine, this);
        this.input.on('pointerup', this.endLine, this);

        this.finishButton = this.add.text(700, 550, 'Finish', {
            fontSize: '20px',
            fill: '#ffffff',
            backgroundColor: '#4a4a4a',
            padding: { x: 10, y: 5 }
        }).setInteractive();

        this.finishButton.on('pointerdown', this.finishTable, this);

        this.instructionText = this.add.text(400, 100, 'Draw a table with 4 legs and a top. Time limit: 30 seconds', {
            fontSize: '18px',
            fill: '#ffffff',
            align: 'center'
        }).setOrigin(0.5);

        this.timeText = this.add.text(50, 50, 'Time: 30', { fontSize: '18px', fill: '#ffffff' });
        this.scoreText = this.add.text(50, 80, 'Score: 0', { fontSize: '18px', fill: '#ffffff' });

        this.timeLeft = 30;
        this.score = 0;

        this.timer = this.time.addEvent({
            delay: 1000,
            callback: this.updateTimer,
            callbackScope: this,
            loop: true
        });
    }

    startLine(pointer) {
        if (this.timeLeft > 0) {
            if (this.lastEndPoint) {
                this.currentLine = new Phaser.Geom.Line(this.lastEndPoint.x, this.lastEndPoint.y, pointer.x, pointer.y);
            } else {
                this.currentLine = new Phaser.Geom.Line(pointer.x, pointer.y, pointer.x, pointer.y);
            }
        }
    }

    drawLine(pointer) {
        if (!this.currentLine || this.timeLeft <= 0) return;

        this.currentLine.x2 = pointer.x;
        this.currentLine.y2 = pointer.y;

        this.graphics.clear();
        this.graphics.lineStyle(2, 0xffffff);

        this.lines.forEach(line => {
            this.graphics.strokeLineShape(line);
        });
        this.graphics.strokeLineShape(this.currentLine);
    }

    endLine(pointer) {
        if (!this.currentLine || this.timeLeft <= 0) return;

        this.lines.push(this.currentLine);
        this.lastEndPoint = { x: this.currentLine.x2, y: this.currentLine.y2 };
        this.currentLine = null;

        this.graphics.clear();
        this.graphics.lineStyle(2, 0xffffff);
        this.lines.forEach(line => {
            this.graphics.strokeLineShape(line);
        });

        this.score += 10;
        this.scoreText.setText('Score: ' + this.score);
    }

    updateTimer() {
        this.timeLeft--;
        this.timeText.setText('Time: ' + this.timeLeft);

        if (this.timeLeft <= 0) {
            this.timer.remove();
            this.finishTable();
        }
    }

    finishTable() {
        this.timer.remove();
        
        let tableScore = this.evaluateTable();
        this.score += tableScore;

        this.add.text(400, 300, 'Table Score: ' + tableScore, {
            fontSize: '24px',
            fill: '#ffffff',
            align: 'center'
        }).setOrigin(0.5);

        this.add.text(400, 350, 'Total Score: ' + this.score, {
            fontSize: '24px',
            fill: '#ffffff',
            align: 'center'
        }).setOrigin(0.5);

        this.time.delayedCall(10000, () => {
            this.scene.start('MainScene');
        });
    }

    evaluateTable() {
        let score = 0;
        
        // Check if there are at least 5 lines (4 legs + 1 top)
        if (this.lines.length >= 5) {
            score += 50;
        }

        // Check if the lines form a closed shape
        if (this.isClosedShape()) {
            score += 50;
        }

        // Bonus points for symmetry
        if (this.isSymmetrical()) {
            score += 25;
        }

        return score;
    }

    isClosedShape() {
        // Simple check: first point should be close to the last point
        if (this.lines.length < 3) return false;
        let firstPoint = { x: this.lines[0].x1, y: this.lines[0].y1 };
        let lastPoint = { x: this.lines[this.lines.length - 1].x2, y: this.lines[this.lines.length - 1].y2 };
        let distance = Phaser.Math.Distance.Between(firstPoint.x, firstPoint.y, lastPoint.x, lastPoint.y);
        return distance < 20;
    }

    isSymmetrical() {
        // Simple symmetry check: compare left half with right half
        let centerX = this.sys.game.config.width / 2;
        let leftPoints = this.lines.filter(line => line.x1 < centerX && line.x2 < centerX).length;
        let rightPoints = this.lines.filter(line => line.x1 > centerX && line.x2 > centerX).length;
        return Math.abs(leftPoints - rightPoints) <= 1;
    }
}    // Phaser game configuration
    let game;
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        parent: 'game',
        scene: [MainScene, IntroScene, TableBuildingScene]
    };

    // Options window functionality
    const optionsWindow = document.getElementById('options-window');
    const applyButton = document.getElementById('apply-options');
    const closeButton = document.getElementById('close-options');
    const fontSizeSelect = document.getElementById('font-size');
    const bgColorInput1 = document.getElementById('bg-color-1');
    const bgColorInput2 = document.getElementById('bg-color-2');

    function showOptionsWindow() {
        optionsWindow.style.display = 'block';
    }

    function hideOptionsWindow() {
        optionsWindow.style.display = 'none';
    }

    function applyOptions() {
        const fontSize = fontSizeSelect.value + 'px';
        const bgColor1 = bgColorInput1.value;
        const bgColor2 = bgColorInput2.value;

        if (game && game.scene.scenes[0]) {
            game.scene.scenes[0].startText.setFontSize(fontSize);
            game.scene.scenes[0].optionsText.setFontSize(fontSize);
            game.scene.scenes[0].titleText.setFontSize(parseInt(fontSize) + 4 + 'px');
        }

        document.body.style.background = `linear-gradient(to bottom right, ${bgColor1}, ${bgColor2})`;

        hideOptionsWindow();
    }

    applyButton.addEventListener('click', applyOptions);
    closeButton.addEventListener('click', hideOptionsWindow);

    function checkScreenSize() {
        const gameContainer = document.getElementById('game-container');
        const smallScreenMessage = document.getElementById('small-screen-message');
        const minWidth = 800; // Minimum width to show the game

        if (window.innerWidth < minWidth) {
            gameContainer.style.display = 'none';
            smallScreenMessage.style.display = 'block';
            if (game) {
                game.destroy(true);
                game = null;
            }
        } else {
            gameContainer.style.display = 'block';
            smallScreenMessage.style.display = 'none';
            if (!game) {
                game = new Phaser.Game(config);
                game.scene.start('MainScene');
            }
        }
    }

    // Call the function initially and on window resize
    window.addEventListener('load', checkScreenSize);
    window.addEventListener('resize', checkScreenSize);
</script>
</body>
</html>
